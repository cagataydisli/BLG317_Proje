<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Technical Staff</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>

<<<<<<< Updated upstream
{% block title %}Teknik Ekip{% endblock %}

{% block content %}

<style>
    /* Sadece bu sayfaya √∂zel k√º√ß√ºk dokunu≈ülar */

    .staff-header {
        border-radius: 1rem;
        background: linear-gradient(135deg, #0d6efd 0%, #6c63ff 100%);
        color: #fff;
        padding: 1.5rem 1.75rem;
        box-shadow: 0 0.35rem 1.2rem rgba(13, 110, 253, 0.25);
    }

    .staff-header h2 {
        font-weight: 600;
        letter-spacing: 0.02em;
    }

    .soft-badge {
        border-radius: 999px;
        padding: 0.15rem 0.75rem;
        font-size: 0.8rem;
        font-weight: 500;
        background-color: rgba(255,255,255,0.18);
        color: #f8f9fa;
    }

    .filter-card, .table-card {
        border-radius: 1rem;
        box-shadow: 0 0.25rem 0.75rem rgba(15, 23, 42, 0.08);
        border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .filter-card .form-control,
    .filter-card .form-select {
        font-size: 0.9rem;
    }

    #staffTable tbody tr:hover {
        background-color: #f8fafc;
        transition: background-color 0.15s ease-in-out;
    }

    .role-pill {
        display: inline-block;
        padding: 0.1rem 0.55rem;
        border-radius: 999px;
        font-size: 0.8rem;
        background-color: #e0f2fe;
        color: #0f172a;
        border: 1px solid #bae6fd;
    }

    .league-pill {
        display: inline-block;
        padding: 0.1rem 0.5rem;
        border-radius: 999px;
        font-size: 0.75rem;
        background-color: #fef9c3;
        color: #78350f;
        border: 1px solid #facc15;
    }

    .pagination .page-link {
        border-radius: 999px !important;
        margin: 0 0.15rem;
        padding: 0.35rem 0.8rem;
        font-size: 0.85rem;
    }

    .pagination .page-item.active .page-link {
        box-shadow: 0 0.25rem 0.5rem rgba(13, 110, 253, 0.3);
    }

    .modal-content {
        border-radius: 1rem;
    }
</style>

<div class="container my-4">

    <!-- √úst Ba≈ülƒ±k -->
    <div class="staff-header mb-4 d-flex justify-content-between align-items-center">
        <div>
            <div class="d-flex align-items-center gap-2 mb-1">
                <span class="fs-4">üë•</span>
                <h2 class="mb-0">Teknik Ekip</h2>
            </div>
            <p class="mb-0 small">
                Liglerde g√∂rev alan ko√ß, asistan, kondisyoner ve saƒülƒ±k ekibi √ºyelerini
                g√∂r√ºnt√ºleyebilir, filtreleyebilir ve yeni kayƒ±t ekleyebilirsin.
            </p>
        </div>
        <div class="text-end d-none d-md-block">
            <span class="soft-badge">
                Sayfa ba≈üƒ±na 50 kayƒ±t ‚Ä¢ Sayfa {{ current_page }} / {{ total_pages }}
            </span>
        </div>
    </div>

    <!-- Filtreler -->
    <div class="card filter-card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label small text-muted mb-1">ƒ∞simde Ara</label>
                    <input
                        type="text"
                        name="search"
                        class="form-control"
                        placeholder="√ñrn: Ataman, Obradovic..."
                        value="{{ search or '' }}"
                    />
                </div>
                <div class="col-md-3">
                    <label class="form-label small text-muted mb-1">Takƒ±m</label>
                    <select name="team" class="form-select">
                        <option value="">T√ºm Takƒ±mlar</option>
                        {% for team_name in filter_teams %}
                            <option value="{{ team_name }}" {% if team_name == selected_team %}selected{% endif %}>
                                {{ team_name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small text-muted mb-1">Rol</label>
                    <select name="role" class="form-select">
                        <option value="">T√ºm Roller</option>
                        {% for r in roles %}
                            <option value="{{ r }}" {% if r == selected_role %}selected{% endif %}>
                                {{ r }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2 d-flex gap-2">
                    <button type="submit" class="btn btn-primary w-100">
                        Filtrele
                    </button>
                    <a href="{{ url_for('staff_page') }}" class="btn btn-outline-secondary" title="Filtreleri temizle">
                        Sƒ±fƒ±rla
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Tablo + D√ºzenle butonlarƒ± -->
    <div class="card table-card mb-4">
        <div class="card-body p-0">
            <div class="d-flex justify-content-between align-items-center px-3 pt-3 pb-2 border-bottom">
                <div>
                    <span class="fw-semibold">Kayƒ±tlar</span>
                    <span class="text-muted small ms-1">
                        (Bu sayfada {{ staff|length }} kayƒ±t g√∂steriliyor)
                    </span>
                </div>
                <div class="d-flex gap-2">
                    <button id="toggleEditMode" class="btn btn-sm btn-outline-primary" onclick="toggleEditMode()">
                        ‚úèÔ∏è D√ºzenle
                    </button>
                    <button id="addStaffBtn" class="btn btn-sm btn-success d-none" data-bs-toggle="modal" data-bs-target="#addStaffModal">
                        + Yeni Staff
                    </button>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle mb-0" id="staffTable">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 70px;">ID</th>
                            <th>ƒ∞sim</th>
                            <th style="width: 210px;">Rol</th>
                            <th>Takƒ±m</th>
                            <th style="width: 140px;">Lig</th>
                            <th class="delete-col d-none text-center" style="width: 90px;">ƒ∞≈ülem</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for member in staff %}
                        <tr id="row-{{ member.staff_id }}">
                            <td class="text-muted small">{{ member.staff_id }}</td>
                            <td>{{ member.name }}</td>
                            <td>
                                {% if member.role %}
                                    <span class="role-pill">{{ member.role }}</span>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>{{ member.team_name or '-' }}</td>
                            <td>
                                {% if member.league %}
                                    <span class="league-pill">{{ member.league }}</span>
                                {% else %}
                                    -
                                {% endif %}
                            </td>

                            <td class="delete-col d-none text-center">
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteStaff({{ member.staff_id }})">
                                    üóëÔ∏è Sil
                                </button>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="text-center py-4 text-muted">
                                Kayƒ±tlƒ± teknik ekip bulunamadƒ±.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Sayfalama -->
    {% if total_pages > 1 %}
    <nav aria-label="Sayfalama">
        <ul class="pagination justify-content-center">

            <!-- √ñnceki -->
            <li class="page-item {% if current_page <= 1 %}disabled{% endif %}">
                <a class="page-link"
                   href="{{ url_for('staff_page',
                                    page=current_page-1,
                                    search=search,
                                    team=selected_team,
                                    role=selected_role) }}">
                    √ñnceki
                </a>
            </li>

            {% set window = 2 %}
            {% set start_page = current_page - window %}
            {% if start_page < 1 %}{% set start_page = 1 %}{% endif %}
            {% set end_page = current_page + window %}
            {% if end_page > total_pages %}{% set end_page = total_pages %}{% endif %}

            {% if start_page > 1 %}
                <li class="page-item {% if current_page == 1 %}active{% endif %}">
                    <a class="page-link"
                       href="{{ url_for('staff_page',
                                        page=1,
                                        search=search,
                                        team=selected_team,
                                        role=selected_role) }}">
                        1
                    </a>
                </li>
                {% if start_page > 2 %}
                    <li class="page-item disabled">
                        <span class="page-link">‚Ä¶</span>
                    </li>
                {% endif %}
            {% endif %}

            {% for p in range(start_page, end_page + 1) %}
                <li class="page-item {% if p == current_page %}active{% endif %}">
                    <a class="page-link"
                       href="{{ url_for('staff_page',
                                        page=p,
                                        search=search,
                                        team=selected_team,
                                        role=selected_role) }}">
                        {{ p }}
                    </a>
                </li>
            {% endfor %}

            {% if end_page < total_pages %}
                {% if end_page < total_pages - 1 %}
                    <li class="page-item disabled">
                        <span class="page-link">‚Ä¶</span>
                    </li>
                {% endif %}
                <li class="page-item {% if current_page == total_pages %}active{% endif %}">
                    <a class="page-link"
                       href="{{ url_for('staff_page',
                                        page=total_pages,
                                        search=search,
                                        team=selected_team,
                                        role=selected_role) }}">
                        {{ total_pages }}
                    </a>
                </li>
            {% endif %}

            <!-- Sonraki -->
            <li class="page-item {% if current_page >= total_pages %}disabled{% endif %}">
                <a class="page-link"
                   href="{{ url_for('staff_page',
                                    page=current_page+1,
                                    search=search,
                                    team=selected_team,
                                    role=selected_role) }}">
                    Sonraki
                </a>
            </li>

        </ul>
    </nav>
    {% endif %}
</div>

<!-- Yeni Staff Ekle Modal -->
<div class="modal fade" id="addStaffModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Yeni Staff Ekle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('add_staff') }}" method="POST">
            <div class="mb-2">
                <label class="form-label">ƒ∞sim Soyisim</label>
                <input type="text" name="technic_member_name" class="form-control" required>
            </div>
            <div class="mb-2">
                <label class="form-label">Rol</label>
                <input type="text" name="technic_member_role" class="form-control" placeholder="Head Coach, Assistant Coach..." required>
            </div>
            <div class="mb-2">
                <label class="form-label">Takƒ±m</label>
                <select name="team_id" class="form-select" required>
                    <option value="">Se√ßiniz...</option>
                    {% for t in teams %}
                        <option value="{{ t.team_id }}">{{ t.team_name }} ({{ t.league }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-2">
                <label class="form-label">Lig (Opsiyonel)</label>
                <input type="text" name="league" class="form-control" placeholder="BSL, TBL, ...">
            </div>
            <div class="mb-2">
                <label class="form-label">Team URL (Opsiyonel)</label>
                <input type="text" name="team_url" class="form-control" placeholder="https://...">
            </div>
            <button type="submit" class="btn btn-primary w-100 mt-3">Kaydet</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
    function toggleEditMode() {
        const deleteCols = document.querySelectorAll('.delete-col');
        const addBtn = document.getElementById('addStaffBtn');
        const editBtn = document.getElementById('toggleEditMode');

        deleteCols.forEach(col => col.classList.toggle('d-none'));
        addBtn.classList.toggle('d-none');

        if (addBtn.classList.contains('d-none')) {
            editBtn.innerText = "‚úèÔ∏è D√ºzenle";
            editBtn.classList.replace("btn-secondary", "btn-outline-primary");
        } else {
            editBtn.innerText = "‚ùå Modu Kapat";
            editBtn.classList.replace("btn-outline-primary", "btn-secondary");
        }
    }

    function deleteStaff(id) {
        if(!confirm("Bu staff kaydƒ±nƒ± silmek istediƒüine emin misin?")) return;

        fetch('/staff/delete/' + id, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const row = document.getElementById('row-' + id);
                if (row) row.remove();
            } else {
                alert("Silinemedi: " + (data.error || 'Bilinmeyen hata'));
            }
        })
        .catch(err => alert("Hata: " + err));
    }
</script>
{% endblock %}
=======
<body class="bg-light">

<div class="container mt-4">

    <h2 class="mb-3">Technical Staff</h2>

    <!-- ================= FILTER FORM ================= -->
    <form method="get" class="row g-2 mb-3">

        <div class="col-md-3">
            <input type="text" name="name" class="form-control"
                   placeholder="Name"
                   value="{{ filters.get('name','') }}">
        </div>

        <div class="col-md-3">
            <input type="text" name="role" class="form-control"
                   placeholder="Role"
                   value="{{ filters.get('role','') }}">
        </div>

        <div class="col-md-3">
            <input type="text" name="team" class="form-control"
                   placeholder="Team"
                   value="{{ filters.get('team','') }}">
        </div>

        <div class="col-md-2">
            <input type="text" name="league" class="form-control"
                   placeholder="League"
                   value="{{ filters.get('league','') }}">
        </div>

        <div class="col-md-1 d-grid">
            <button class="btn btn-primary">Filter</button>
        </div>

    </form>

    <!-- ================= ADD BUTTON ================= -->
    {% if current_user.is_authenticated %}
    <button class="btn btn-success mb-3"
            data-bs-toggle="modal"
            data-bs-target="#addModal">
        ‚ûï Add Staff
    </button>
    {% endif %}

    <!-- ================= TABLE ================= -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover bg-white">
            <thead class="table-dark">
            <tr>
                <th>Name</th>
                <th>Role</th>
                <th>Team</th>
                <th>League</th>
                {% if current_user.is_authenticated %}
                <th width="140">Actions</th>
                {% endif %}
            </tr>
            </thead>

            <tbody>
            {% for s in staff %}
                <tr>
                    <td>{{ s.name }}</td>
                    <td>{{ s.role }}</td>
                    <td>{{ s.team_name }}</td>
                    <td>{{ s.league }}</td>

                    {% if current_user.is_authenticated %}
                    <td>
                        <button class="btn btn-sm btn-warning"
                                onclick="openEdit(
                                    '{{ s.technic_id }}',
                                    '{{ s.name }}',
                                    '{{ s.role }}',
                                    '{{ s.team_id }}',
                                    '{{ s.league }}'
                                )">
                            Edit
                        </button>

                        <button class="btn btn-sm btn-danger"
                                onclick="deleteStaff({{ s.technic_id }})">
                            Delete
                        </button>
                    </td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ================= PAGINATION ================= -->
    <nav>
        <ul class="pagination">

            {% if current_page > 1 %}
            <li class="page-item">
                <a class="page-link"
                   href="?{{ filters.to_dict() | dictsort | urlencode }}&page={{ current_page-1 }}">
                    Prev
                </a>
            </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">
                    Page {{ current_page }} / {{ total_pages }}
                </span>
            </li>

            {% if current_page < total_pages %}
            <li class="page-item">
                <a class="page-link"
                   href="?{{ filters.to_dict() | dictsort | urlencode }}&page={{ current_page+1 }}">
                    Next
                </a>
            </li>
            {% endif %}

        </ul>
    </nav>

</div>

<!-- ================= ADD MODAL ================= -->
<div class="modal fade" id="addModal">
    <div class="modal-dialog">
        <form method="post" action="/staff/add" class="modal-content">

            <div class="modal-header">
                <h5>Add Staff</h5>
            </div>

            <div class="modal-body">

                <input class="form-control mb-2" name="name" placeholder="Name" required>
                <input class="form-control mb-2" name="role" placeholder="Role" required>
                <input class="form-control mb-2" name="team_id" placeholder="Team ID">
                <input class="form-control mb-2" name="league" placeholder="League">

            </div>

            <div class="modal-footer">
                <button class="btn btn-success">Save</button>
            </div>

        </form>
    </div>
</div>

<!-- ================= EDIT MODAL ================= -->
<div class="modal fade" id="editModal">
    <div class="modal-dialog">
        <form method="post" action="/staff/update" class="modal-content">

            <input type="hidden" name="technic_id" id="e_id">

            <div class="modal-header">
                <h5>Edit Staff</h5>
            </div>

            <div class="modal-body">

                <input class="form-control mb-2" id="e_name" name="name" required>
                <input class="form-control mb-2" id="e_role" name="role" required>
                <input class="form-control mb-2" id="e_team" name="team_id">
                <input class="form-control mb-2" id="e_league" name="league">

            </div>

            <div class="modal-footer">
                <button class="btn btn-warning">Update</button>
            </div>

        </form>
    </div>
</div>

<script>
function openEdit(id, name, role, team, league) {
    document.getElementById('e_id').value = id;
    document.getElementById('e_name').value = name;
    document.getElementById('e_role').value = role;
    document.getElementById('e_team').value = team;
    document.getElementById('e_league').value = league;

    new bootstrap.Modal(document.getElementById('editModal')).show();
}

function deleteStaff(id) {
    if (!confirm("Delete this staff member?")) return;

    fetch(`/staff/delete/${id}`, { method: 'POST' })
        .then(r => r.json())
        .then(d => {
            if (d.success) location.reload();
            else alert(d.error);
        });
}
</script>

</body>
</html>
>>>>>>> Stashed changes
