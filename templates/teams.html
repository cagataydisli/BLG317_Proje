{% extends "base.html" %}

{% block title %}TakÄ±m Listesi{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Ãœst BaÅŸlÄ±k ve Butonlar -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2>TakÄ±m Listesi</h2>
            <a href="/" class="btn btn-sm btn-outline-secondary">â† Ana Sayfa</a>
        </div>

        <div>
            <!-- DÃ¼zenleme Modunu AÃ§/Kapat Butonu -->
            <button id="toggleEditMode" class="btn btn-outline-primary" onclick="toggleEditMode()">
                âœï¸ DÃ¼zenle
            </button>

            <!-- Yeni TakÄ±m Ekle Butonu (BaÅŸlangÄ±Ã§ta Gizli) -->
            <button id="addTeamBtn" class="btn btn-success d-none" data-bs-toggle="modal" data-bs-target="#addTeamModal">
                + Yeni TakÄ±m
            </button>
        </div>
    </div>

    <!-- TakÄ±m Tablosu -->
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Staff ID</th>
                    <th>Lig</th>
                    <th>TakÄ±m AdÄ±</th>
                    <th>Åehir</th>
                    <th>KuruluÅŸ</th>
                    <th>Salon & Kapasite</th>
                    <!-- Silme sÃ¼tunu baÅŸlangÄ±Ã§ta gizli (d-none) -->
                    <th class="delete-col d-none" style="width: 100px;">Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody>
                {% for team in teams %}
                <tr id="row-{{ team.team_id }}">
                    <!-- TakÄ±m ID -->
                    <td><strong>{{ team.team_id }}</strong></td>
                    
                    <!-- Staff ID -->
                    <td>
                        {% if team.staff_id %}
                            <span class="badge bg-secondary">{{ team.staff_id }}</span>
                        {% else %}
                            <span class="text-muted small">-</span>
                        {% endif %}
                    </td>
                    
                    <!-- Lig -->
                    <td><span class="badge bg-info text-dark">{{ team.league or '-' }}</span></td>
                    
                    <!-- Ä°sim ve Link -->
                    <td>
                        {% if team.team_url %}
                            <a href="{{ team.team_url }}" target="_blank" class="fw-bold text-decoration-none">
                                {{ team.team_name }} ğŸ”—
                            </a>
                        {% else %}
                            {{ team.team_name }}
                        {% endif %}
                    </td>
                    
                    <!-- Åehir ve YÄ±l -->
                    <td>{{ team.team_city or '-' }}</td>
                    <td>{{ team.team_year or '-' }}</td>
                    
                    <!-- Salon Bilgileri -->
                    <td>
                        <div class="fw-bold">{{ team.saloon_name or '-' }}</div>
                        <small class="text-muted">
                            {% if team.saloon_capacity %}
                                ğŸ‘¥ {{ "{:,}".format(team.saloon_capacity) }}
                            {% else %}
                                Kapasite Belirsiz
                            {% endif %}
                        </small>
                    </td>

                    <!-- Silme Butonu (BaÅŸlangÄ±Ã§ta gizli) -->
                    <td class="delete-col d-none">
                        <button class="btn btn-sm btn-danger" onclick="deleteTeam({{ team.team_id }})">
                            ğŸ—‘ï¸ Sil
                        </button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" class="text-center py-4">
                        <p class="text-muted mb-0">HenÃ¼z kayÄ±tlÄ± bir takÄ±m bulunmamaktadÄ±r.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Yeni TakÄ±m Ekleme ModalÄ± -->
<div class="modal fade" id="addTeamModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">Yeni TakÄ±m Ekle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form action="/teams/add" method="POST">
            
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label fw-bold">TakÄ±m ID (Zorunlu):</label>
                    <input type="number" name="team_id" class="form-control" placeholder="Ã–rn: 2025" required>
                </div>
                <div class="col-md-8">
                    <label class="form-label fw-bold">TakÄ±m AdÄ± (Zorunlu):</label>
                    <input type="text" name="team_name" class="form-control" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label">Lig:</label>
                    <input type="text" name="league" class="form-control" placeholder="bsl-2024-2025">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Åehir:</label>
                    <input type="text" name="team_city" class="form-control">
                </div>
                <div class="col-md-4">
                    <label class="form-label">KuruluÅŸ YÄ±lÄ±:</label>
                    <input type="number" name="team_year" class="form-control" placeholder="1900">
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-8">
                    <label class="form-label">Logo/Web URL:</label>
                    <input type="text" name="team_url" class="form-control" placeholder="https://...">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Teknik Kadro ID:</label>
                    <input type="number" name="staff_id" class="form-control">
                </div>
            </div>

            <hr>
            <h6 class="text-success">Salon Bilgileri</h6>

            <div class="row mb-3">
                <div class="col-md-8">
                    <label class="form-label">Salon AdÄ±:</label>
                    <input type="text" name="saloon_name" class="form-control">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Kapasite:</label>
                    <input type="number" name="saloon_capacity" class="form-control" placeholder="SayÄ± giriniz">
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Salon Adresi:</label>
                <textarea name="saloon_address" class="form-control" rows="2"></textarea>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-success">âœ… TakÄ±mÄ± Kaydet</button>
            </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
    // DÃ¼zenleme Modunu AÃ§/Kapat
    function toggleEditMode() {
        const deleteCols = document.querySelectorAll('.delete-col');
        const addBtn = document.getElementById('addTeamBtn');
        const editBtn = document.getElementById('toggleEditMode');

        // Gizli olanlarÄ± gÃ¶ster, gÃ¶sterilenleri gizle (toggle)
        deleteCols.forEach(col => col.classList.toggle('d-none'));
        addBtn.classList.toggle('d-none');

        // Buton metnini deÄŸiÅŸtir
        if (addBtn.classList.contains('d-none')) {
            editBtn.innerHTML = "âœï¸ DÃ¼zenle";
            editBtn.classList.replace("btn-secondary", "btn-outline-primary");
        } else {
            editBtn.innerHTML = "âŒ Modu Kapat";
            editBtn.classList.replace("btn-outline-primary", "btn-secondary");
        }
    }

    // TakÄ±m Silme Fonksiyonu
    function deleteTeam(id) {
        if(!confirm("Bu takÄ±mÄ± silmek istediÄŸine emin misin?")) return;
        
        // POST isteÄŸi atÄ±yoruz: /teams/delete/<id>
        fetch('/teams/delete/' + id, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // BaÅŸarÄ±lÄ±ysa satÄ±rÄ± tablodan animasyonla sil
                const row = document.getElementById('row-' + id);
                row.style.backgroundColor = "#ffcccc";
                setTimeout(() => row.remove(), 500);
            } else {
                alert("Hata: " + (data.error || "Bilinmeyen hata"));
            }
        })
        .catch(err => alert("BaÄŸlantÄ± HatasÄ±: " + err));
    }
</script>
{% endblock %}