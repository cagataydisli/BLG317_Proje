{% extends "base.html" %}

{% block title %}Oyuncu Listesi{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2>Oyuncu Listesi</h2>
            <a href="/" class="btn btn-sm btn-outline-secondary">â† Ana Sayfaya DÃ¶n</a>
        </div>

        <div>
            <button id="toggleEditMode" class="btn btn-outline-primary" onclick="toggleEditMode()">
                âœï¸ DÃ¼zenle
            </button>

            <button id="addPlayerBtn" class="btn btn-success d-none" data-bs-toggle="modal" data-bs-target="#addPlayerModal">
                + Yeni Oyuncu
            </button>
        </div>
    </div>

    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Oyuncu AdÄ±</th>
                <th>TakÄ±m</th>
                <th>Boy</th>
                <th>DoÄŸum Tarihi</th>
                <th>Lig</th>
                <th class="delete-col d-none">Ä°ÅŸlem</th>
            </tr>
        </thead>
        <tbody>
            {% for player in players %}
            <tr id="row-{{ player.player_id }}">
                <td>{{ player.player_id }}</td>
                <td>{{ player.player_name }}</td>
                <td>
                    {% if player.team_url %}
                        <a href="{{ player.team_url }}" target="_blank">{{ player.team_name or 'TakÄ±msÄ±z' }}</a>
                    {% else %}
                        {{ player.team_name or 'TakÄ±msÄ±z' }}
                    {% endif %}
                </td>
                <td>{{ player.player_height or '-' }}</td>
                <td>{{ player.player_birthdate or '-' }}</td>
                <td>{{ player.league or '-' }}</td>

                <td class="delete-col d-none">
                    <button class="btn btn-sm btn-danger" onclick="deletePlayer({{ player.player_id }})">
                        ğŸ—‘ï¸ Sil
                    </button>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center">KayÄ±tlÄ± oyuncu bulunamadÄ±.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="addPlayerModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Yeni Oyuncu Ekle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form action="/players/add" method="POST">
            <div class="mb-2">
                <label>Oyuncu ID (Benzersiz):</label>
                <input type="number" name="player_id" class="form-control" required>
            </div>
            <div class="mb-2">
                <label>Ad Soyad:</label>
                <input type="text" name="player_name" class="form-control" required>
            </div>
            <div class="mb-2">
                <label>TakÄ±m ID (Opsiyonel):</label>
                <input type="number" name="team_id" class="form-control" placeholder="Ã–rn: 101">
            </div>
            <div class="mb-2">
                <label>Boy:</label>
                <input type="text" name="player_height" class="form-control">
            </div>
            <div class="mb-2">
                <label>DoÄŸum YÄ±lÄ±:</label>
                <input type="text" name="player_birthdate" class="form-control">
            </div>
            <div class="mb-2">
                <label>Lig:</label>
                <input type="text" name="league" class="form-control">
            </div>
            <button type="submit" class="btn btn-primary w-100 mt-3">Kaydet</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
    // DÃ¼zenleme Modunu AÃ§/Kapat
    function toggleEditMode() {
        const deleteCols = document.querySelectorAll('.delete-col');
        const addBtn = document.getElementById('addPlayerBtn');
        const editBtn = document.getElementById('toggleEditMode');

        // Gizli olanlarÄ± gÃ¶ster, gÃ¶sterilenleri gizle (toggle)
        deleteCols.forEach(col => col.classList.toggle('d-none'));
        addBtn.classList.toggle('d-none');

        // Buton metnini deÄŸiÅŸtir
        if (addBtn.classList.contains('d-none')) {
            editBtn.innerText = "âœï¸ DÃ¼zenle";
            editBtn.classList.replace("btn-secondary", "btn-outline-primary");
        } else {
            editBtn.innerText = "âŒ Modu Kapat";
            editBtn.classList.replace("btn-outline-primary", "btn-secondary");
        }
    }

    // Oyuncu Silme Fonksiyonu (AJAX ile sayfayÄ± yenilemeden siler)
    function deletePlayer(id) {
        if(!confirm("Bu oyuncuyu silmek istediÄŸine emin misin?")) return;

        fetch('/players/delete/' + id, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // BaÅŸarÄ±lÄ±ysa satÄ±rÄ± tablodan kaldÄ±r
                document.getElementById('row-' + id).remove();
            } else {
                alert("Silinemedi: " + data.error);
            }
        })
        .catch(err => alert("Hata: " + err));
    }
</script>
{% endblock %}